## Redux 미들웨어
### 1) 미들웨어란?
![리덕스 미들웨어](https://bit.ly/3oPVhGk)

* 리덕스 미들웨어란 리덕스 store에서 action이 dispatch되었을 떄, action을 변형하거나/무시하거나/비동기적인 작업을 수행하는 등의 작업을 할 수 있도록 도와주는 일종의 플러그인이다.

<br/>

> :point_right: API와 통신을 할 때 `비동기 처리`를 하기 위해 미들웨어를 사용한다. <br/>
> :point_right: 리덕스는 동기적인 상태 관리 라이브러리이기 때문에, 미들웨어를 사용해 비동기 작업을 동기적으로 처리할 수 있기 때문이다!

<br/>

* 미들웨어는 리덕스 store에 삽입되며, action이 dispatch되었을 때 미들웨어가 실행된다.

* 미들웨어는 액션을 처리하기 전과 후에 처리할 로직을 정의할 수 있다.

* *ex. action이 함수일 경우 해당 함수를 실행하고, 객체일 경우 그대로 그 다음 미들웨어로 전달*

* 미들웨어를 사용함으로써 리덕스 애플리케이션에서 `비동기 작업을 처리`하거나, `로깅`, `에러 핸들링` 등의 기능을 구현할 수 있다.

* 리덕스에서 많이 사용되는 미들웨어 중에는 `Redux Thunk`, `Redux Saga`, `Redux Observable` 등이 있으며, 각 미들웨어는 비동기 작업을 처리하는 방식이나 기능 등이 서로 다르다.


<br/>

---

<br/>

## [참고] :question: API와 통신을 할 때 비동기 처리를 하는 이유는?

1. 비동기 처리를 하면 애플리케이션의 성능이 향상된다.

    * 동기적으로 작업을 처리하면 해당 작업이 끝날 때까지 다음 작업을 수행할 수 없기 때문에, UI가 블로킹되거나 애플리케이션이 느려지는 현상이 발생할 수 있다.

    * 비동기 처리를 하면, 작업을 백그라운드에서 수행할 수 있기 때문에 UI가 블로킹되지 않고, 애플리케이션에서 빠르게 동작할 수 있다.

<br/>

2. API와 통신을 할 때 비동기 처리를 하면, 응답을 기다리는 동안 다른 작업을 수행할 수 있다.

    * 응답을 기다리는 동안 다른 작업을 수행할 수 있다.

    * 비동기 처리를 하지 않으면, 요청을 기다리는 동안 다른 작업을 수행할 수 없기 때문에 사용자 경험이 나빠질 수 있다.

<br/>

> :point_right: API와 통신을 할 때 비동기 처리를 하는 것은 애플리케이션의 성능을 향상시키고, 사용자 경험을 개선하는데 큰 도움을 준다!

<br/>

---

<br/>

## thunk
### 1) thunk 소개
* `리덕스 미들웨어` 중 하나로, 리덕스 액션 객체를 반환하는 대신 `함수를 반환`할 수 있게 해준다.

  * 이 함수는 리덕스의 dispatch 메서드를 인자로 받아 필요한 작업을 수행한 이후 dispatch를 호출하거나, 또 다른 액션을 dispatch하는 등의 작업을 할 수 있다.

<br/>

* 주로 `비동기 작업`을 다룰 때 많이 사용된다.

  * 서버에서 데이터를 가져와 리덕스 store에 저장하는 작업을 할 때, thunk로 비동기 작업을 처리하고 작업이 완료된 후에는 action을 dispatch하여 store를 업데이트 할 수 있다.

<br/>

* API 호출 중 발생하는 `오류 처리` 등의 작업을 처리할 수도 있다.

<br/>

### 2) [참고] :question: 서버에서 데이터를 가져와 리덕스 store에 저장할 때 비동기 방식으로 작업하는 이유는?
1. `사용자 경험 향상`

    * 사용자가 다른 작업을 수행하면서도 서버에서 데이터를 가져와 store에 업데이트할 수 있으므로, 애플리케이션의 반응성과 사용자 경험을 향상시킬 수 있다.

<br/>

2. `성능 개선`

    * 여러 개의 작업을 동시에 수행할 수 있으므로 애플리케이션의 성능을 개선할 수 있다.

<br/>

3. `예외 처리`

    * 서버에서 데이터를 가져오는 작업은 외부 요인에 의해 실패할 가능성이 있고, 이를 동기 방식으로 처리하면 애플리케이션이 중단될 수 있다.

    * 반면 비동기 방식은 예외 처리를 할 수 있으므로 애플리케이션의 안정성을 높일 수 있다.

<br/>

### 3) thunk 구현 순서
1. thunk 함수 만들기: `createAsyncThunk` (RTK 내장 API)

2. createSlice > extraReducer에 thunk 등록하기

3. dispatch (thunk 함수) 하기

4. 테스트

<br/>

---

<br/>

## [참고] :question: thunk와 리액트 쿼리
### 1) 리액트 쿼리도 미들웨어일까?
* 리액트 쿼리는 `미들웨어가 아니다.`

* 리액트 쿼리는 리액트 애플리케이션에서 비동기 데이터를 관리하기 위한 `라이브러리`이다.

* 리액트 쿼리는 다음과 같은 기능을 제공한다.
    * 서버에서 데이터 가져오기

    * 데이터 업데이트 및 삭제

    * 캐시 관리

    * 오류 관리

* 리액트 쿼리는 보통 리덕스와 함께 사용되며, 별도의 미들웨어 없이도 API 호출과 캐싱 등의 비동기 작업을 처리할 수 있다.

<br/>

### 2) 리액트 쿼리과 thunk의 차이점은?
| 구분 | 리액트 쿼리 | thunk |
| --- | --- | --- |
| 공&nbsp;통&nbsp;점 | `비동기 처리`를 쉽게 할 수 있도록 도와줌 ||
| 차&nbsp;이&nbsp;점 | * 비동기 데이터 요청을 관리하는 `라이브러리` <br/> * API 호출 및 `데이터 캐싱`, `오류 처리`, 다양한 상`태 변화`에 대응하는 로직 등을 자동으로 처리해줌 | * 리덕스에서 비동기 처리를 위한 `미들웨어` <br/> * 리덕스 store의 dispatch 함수와 getState함수를 매개변수로 받아 비동기 작업 처리 후 리덕스 action을 dispatch <br/> * `리덕스 store와 밀접하게 관련`되어있음 |


<br/>

---

<br/>

## 정리
* 리덕스 미들웨어를 사용하면 action이 리듀서로 전달되기 전에 `중간에` 어떤 작업을 더 할 수 있다.

* thunk를 사용하면 객체가 아닌 `함수를 disptch` 할 수 있게 해준다.

* 리덕스 툴킷에서 thunk 함수를 생성할 때는 `createAsyncThunk`를 이용한다.

* `createAsyncThunk()`의 첫번째 자리에는 `action value`, 두번째에는 `함수`가 들어간다.

  * 두번째로 들어가는 함수에서 2개의 인자를 꺼내 사용할 수 있는데, 첫번째 인자는 컴포넌트에서 보내준 `payload`이고, 두번째 인자는 thunk에서 제공하는 여러가지 `기능`이다.

  * `dispatch`: thunk 함수 안에서 dispatch를 할 때 사용

  * `getState`: 함수 안에서 현재 리덕스 모듈의 state 값을 사용하고 싶을 때 사용